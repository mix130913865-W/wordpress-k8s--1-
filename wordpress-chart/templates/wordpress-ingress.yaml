{{- if .Values.ingress.enabled }} # Helm conditional：只有 ingress.enabled=true 才建立 Ingress

apiVersion: networking.k8s.io/v1 # Kubernetes API version，Ingress 屬於 networking.k8s.io/v1
kind: Ingress # Resource type：Ingress，用來管理外部 HTTP/HTTPS 流量到 Service

metadata:
  name: {{ include "wordpress.fullname" . }}-ingress # Ingress name，使用 Helm helper 生成
  labels:
    {{- include "wordpress.labels" . | nindent 4 }} # 套用 Chart 共用 labels
  annotations:
    {{- with .Values.ingress.annotations }}
    {{- toYaml . | nindent 4 }} # 自訂 annotations，從 values.yaml 注入
    {{- end }}
    kubernetes.io/ingress.class: {{ .Values.ingress.className | quote }} # 指定 ingress controller class

spec:
  {{- if .Values.ingress.className }}
  ingressClassName: {{ .Values.ingress.className }} # 指定 IngressClass（K8s 1.18+）
  {{- end }}

  rules:
    - host: {{ .Values.ingress.host }} # 對應域名
      http:
        paths:
          - path: / # URL path
            pathType: Prefix # 匹配方式：Prefix
            backend:
              service:
                name: {{ include "wordpress.fullname" . }} # 指向 WordPress Service
                port:
                  number: {{ .Values.wordpress.service.port }} # Service port

  {{- with .Values.ingress.tls }}
  tls:
    {{- toYaml . | nindent 4 }} # TLS 設定（如 secretName, hosts）
  {{- end }}

{{- end }} # 結束 Helm conditional
